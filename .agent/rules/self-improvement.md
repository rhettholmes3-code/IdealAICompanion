---
trigger: model_decision
description: 在完成每个开发任务后（代码、问题、项目结构、文档过时），主动评估是否有可改进的模式、流程或规范，并更新相应配置文件。
---

# 自我迭代机制 (v2.0)

## 核心原则
在完成每个开发任务后，主动评估是否有可改进的模式、流程或规范，并更新相应配置文件。

## 触发时机

### 1. 代码开发后
当完成功能开发时，评估：
- [ ] 是否有可复用的代码模式？→ 更新 `code-conventions.md`
- [ ] 游戏逻辑是否足够有趣且平衡？→ 记录游戏设计心得
- [ ] 多智能体协作是否流畅？→ 优化调度逻辑

### 2. 问题解决后
当解决 bug 或复杂问题时，评估：
- [ ] 解决方案是否值得记录？→ 创建或更新对应工作流
- [ ] 是否涉及 ZEGO SDK 经验？→ 补充到 `zegoaiagentdoc.md`
- [ ] 意图识别是否有误判？→ 优化 Dispatcher Prompt

### 3. 项目结构变化后
当添加新目录、新模块时，评估：
- [ ] `project-overview.md` 是否需要更新？
- [ ] 是否需要新的规则文件？

### 4. 发现文档过时后
当发现现有配置与实际不符时：
- [ ] 立即更新对应配置文件
- [ ] 通知用户变更内容

## 更新规范

### 更新前
- 确认变更对项目有实际价值
- 变更应该是经过验证的经验

### 更新时
- 保持文件结构一致
- 添加简短说明解释变更原因
- 非破坏性更新可直接进行

### 更新后
- 在任务总结中提及配置更新
- 重大变更应询问用户确认

### 5. 技能迭代 (Skill Evolution)
当发现更好的代码模式或修复了新类型的 Bug 时：
- [ ] 检查是否有对应的 `.agent/skills/` 需要更新？
- [ ] 是否需要创建新的 Skill？
- [ ] 更新 `audit_zego_compliance` 以包含新的检查规则。

### 6. 上下文卫生 (Context Hygiene) - **对抗遗忘与忽略**
为了防止 Rule 被遗忘或因上下文过长被忽略（Attention Dilution）：
- **索引优先**: 依赖 `code-conventions.md` 和 `zegoaiagentdoc.md` 作为轻量级索引，而不是把所有知识都塞进 System Prompt。
- **按需加载**: 不要在一次对话中 `view_file` 所有的 Skill。只读取当前任务必须的 Skill。
- **验证胜于记忆 (Verification > Memory)**: 
  - **不要** 依赖自己“记得”所有规则。
  - **要** 习惯性运行 `audit` 类技能（如 `audit_zego_compliance`）。让工具去检查，而不是靠脑子。
  - 在 `task.md` 中显式列出“运行检查工具”作为一步。
- **原子化任务**: 如果上下文太多导致“变笨”，尝试将大任务拆解为多个原子任务，每次只关注一个小点。

## 禁止事项
- 不随意删除现有规则
- 不添加未经验证的实验性内容
- 不在规则中包含敏感信息（API Key 等）

