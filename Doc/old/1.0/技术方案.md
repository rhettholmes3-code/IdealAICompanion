# æŠ€æœ¯æ–¹æ¡ˆ

## 1. ç³»ç»Ÿæ¶æ„

### 1.1 æ•´ä½“æ¶æ„ (v2.0)

> **æ ¸å¿ƒå˜æ›´**: å¼•å…¥ã€Œäººè®¾ LLM + è°ƒåº¦ Agentã€åˆ†å±‚æ¶æ„ï¼Œæ”¯æŒå¤æ‚ä»»åŠ¡ä¸æ¸¸æˆäº’åŠ¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨ (H5)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¸šåŠ¡ UI å±‚        â”‚        â”‚  ZEGO Express SDK            â”‚  â”‚
â”‚  â”‚  - é€šè¯/æ¸¸æˆç•Œé¢    â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  - éŸ³é¢‘é‡‡é›†/æ¨æµ/æ‹‰æµ        â”‚  â”‚
â”‚  â”‚  - çŠ¶æ€/å­—å¹•å±•ç¤º    â”‚        â”‚  - ç™»å½•æˆ¿é—´/æµç®¡ç†           â”‚  â”‚
â”‚  â”‚  - åŠ¨æ€èƒŒæ™¯        â”‚        â”‚  - éŸ³é¢‘æ’­æ”¾                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP API                           â”‚ RTC æµ
           â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ZEGO äº‘æœåŠ¡                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ZEGO AI Agent æœåŠ¡      â”‚   â”‚  ZEGO RTC æˆ¿é—´æœåŠ¡           â”‚ â”‚
â”‚  â”‚  - Agent å®ä¾‹æ‰˜ç®¡        â”‚â†â”€â”€â†’â”‚  - æˆ¿é—´ç®¡ç†                  â”‚ â”‚
â”‚  â”‚  - LLM/TTS/ASR èšåˆ      â”‚   â”‚  - æµåª’ä½“è½¬å‘                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Server API (å›è°ƒ & æ§åˆ¶)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡åå° (Next.js - v2.0)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  è°ƒåº¦ä¸­å¿ƒ     â”‚  â”‚  æ¸¸æˆå¼•æ“    â”‚  â”‚  èƒ½åŠ›æœåŠ¡           â”‚    â”‚
â”‚  â”‚ - æ„å›¾è¯†åˆ«    â”‚  â”‚ - æµ·é¾Ÿæ±¤     â”‚  â”‚ - æ–°é—»èšåˆ          â”‚    â”‚
â”‚  â”‚ - ä»»åŠ¡åˆ†å‘    â”‚  â”‚ - çŒœè°œ       â”‚  â”‚ - å¤©æ°”æŸ¥è¯¢          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ Agent ç®¡ç†   â”‚  â”‚ Prompt ç®¡ç†  â”‚                             â”‚
â”‚  â”‚ - äººè®¾é…ç½®    â”‚  â”‚ - åŠ¨æ€åœºæ™¯   â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆé€‰å‹

#### å‰ç«¯ (H5)
- **æ¡†æ¶**: React 18+ (ä½¿ç”¨ Vite æ„å»º)
- **æ ·å¼æ–¹æ¡ˆ**: Tailwind CSS 3+
- **SDK**: ZEGO Express SDK (AI Agent ç‰ˆ)
- **æ–°å¢æ¨¡å—**: æ¸¸æˆçŠ¶æ€ UI ç»„ä»¶, åŠ¨æ€èƒŒæ™¯åˆ‡æ¢

#### åç«¯ (Server)
- **æ¡†æ¶**: Next.js 14+ (App Router)
- **AI æ¶æ„**: 
  - **Persona LLM**: è´Ÿè´£å¯¹è¯ä¸å…±æƒ… (ZEGO æ‰˜ç®¡)
  - **Dispatcher**: è´Ÿè´£æ„å›¾è¯†åˆ«ä¸è·¯ç”± (Backend LLM Call)
- **å¤–éƒ¨èƒ½åŠ›**: é˜¿é‡Œç™¾ç‚¼ API (æ–°é—»/æœç´¢)

#### å¤–éƒ¨æœåŠ¡
- **ZEGO AI Agent API**: æ™ºèƒ½ä½“ç®¡ç†å’Œå®ä¾‹æ§åˆ¶
- **LLM æœåŠ¡**: é˜¿é‡Œç™¾ç‚¼ (é€šè¿‡ ZEGO æ‰˜ç®¡è°ƒç”¨)
- **TTS æœåŠ¡**: MiniMax (ç”± ZEGO æ‰˜ç®¡)
- **ASR æœåŠ¡**: ç”± ZEGO æ‰˜ç®¡

---

## 2. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 2.1 å‰ç«¯ (H5)

#### 2.1.1 ç›®å½•ç»“æ„

```
Source/
â”œâ”€â”€ web/                        # å‰ç«¯ React é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # React ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ CallPage.tsx    # é€šè¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateCallPage.tsx  # åˆ›å»ºé€šè¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Waveform.tsx    # éŸ³æµªç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ SubtitleDisplay.tsx  # å­—å¹•å±•ç¤º (ä½¿ç”¨ ZEGO å­—å¹•ç±»)
â”‚   â”‚   â”‚   â””â”€â”€ StatusBadge.tsx # çŠ¶æ€å¾½ç« 
â”‚   â”‚   â”œâ”€â”€ hooks/              # React Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useZegoRTC.ts   # RTC ç®¡ç† Hook
â”‚   â”‚   â”‚   â””â”€â”€ useSubtitle.ts  # å­—å¹•ç®¡ç† Hook
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ zego-subtitle.ts   # ZEGO å­—å¹•å¤„ç†ç±» (å®˜æ–¹æä¾›)
â”‚   â”‚   â”‚   â””â”€â”€ rtc-client.ts   # RTC å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”‚   â””â”€â”€ xiaoye_avatar.png
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚   â”‚   â””â”€â”€ index.css           # Tailwind å…¥å£
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ tsconfig.json
â””â”€â”€ server/                     # åç«¯ Next.js é¡¹ç›®
    â””â”€â”€ (è§åç«¯ç›®å½•ç»“æ„)
```

#### 2.1.2 æ ¸å¿ƒé€»è¾‘

**åˆå§‹åŒ–æµç¨‹**
```javascript
// 1. é¡µé¢åŠ è½½
window.onload = async () => {
  // åˆå§‹åŒ– ZEGO Express å¼•æ“
  zegoEngine = new ZegoExpressEngine(APP_ID, SERVER_URL);
  
  // ç”Ÿæˆç”¨æˆ· ID å’Œ Token (é€šè¿‡åç«¯ API)
  const { userId, token } = await fetchToken();
  
  // ç™»å½•æˆ¿é—´
  await zegoEngine.loginRoom(roomId, token, { userID: userId });
};
```

**é€šè¯æµç¨‹**
```javascript
// 2. ç”¨æˆ·ç‚¹å‡»é€šè¯æŒ‰é’®
async function startCall() {
  // 2.1 å¼€å¯éº¦å…‹é£å¹¶æ¨æµ
  const localStream = await zegoEngine.createStream({
    camera: { audio: true, video: false }
  });
  await zegoEngine.startPublishingStream(userStreamId, localStream);
  
  // 2.2 é€šçŸ¥åç«¯åˆ›å»º AI Agent å®ä¾‹
  const { agentInstanceId } = await fetch('/api/agent/create', {
    method: 'POST',
    body: JSON.stringify({ roomId, userId })
  }).then(r => r.json());
  
  // 2.3 ç›‘å¬æµäº‹ä»¶ï¼Œæ‹‰å– AI æµ
  zegoEngine.on('roomStreamUpdate', (roomID, updateType, streamList) => {
    if (updateType === 'ADD') {
      const agentStream = streamList.find(s => s.streamID === agentStreamId);
      if (agentStream) {
        zegoEngine.startPlayingStream(agentStreamId);
      }
    }
  });
}
```

**ç»“æŸé€šè¯**
```javascript
async function endCall() {
  // åœæ­¢æ¨æµ
  await zegoEngine.stopPublishingStream(userStreamId);
  
  // ç™»å‡ºæˆ¿é—´
  await zegoEngine.logoutRoom(roomId);
  
  // é€šçŸ¥åç«¯é”€æ¯å®ä¾‹
  await fetch('/api/agent/destroy', {
    method: 'POST',
    body: JSON.stringify({ agentInstanceId })
  });
}
```

### 2.2 åç«¯ (Next.js)

#### 2.2.1 ç›®å½•ç»“æ„

```
server/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ auth/
â”‚       â”‚   â””â”€â”€ token/route.ts      # ç”Ÿæˆ ZEGO Token
â”‚       â””â”€â”€ agent/
â”‚           â”œâ”€â”€ register/route.ts   # æ³¨å†Œ Agent
â”‚           â”œâ”€â”€ create/route.ts     # åˆ›å»º Agent å®ä¾‹
â”‚           â””â”€â”€ destroy/route.ts    # é”€æ¯ Agent å®ä¾‹
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ zego-client.ts              # ZEGO API å®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ prompt-manager.ts           # Prompt æ¨¡æ¿ç®¡ç†
â”‚   â””â”€â”€ config.ts                   # é…ç½®ç®¡ç†
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ agent-config.json           # Agent åŸºç¡€é…ç½®
â”‚   â””â”€â”€ prompts/
â”‚       â””â”€â”€ xiaoye.xml              # å°å¶äººè®¾ Prompt
â””â”€â”€ .env.local                      # ç¯å¢ƒå˜é‡
```

#### 2.2.2 ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.local
ZEGO_APP_ID=453368898
ZEGO_APP_SIGN=a841d047705d01b74ec0dbcabca4e8d3d00245ae10970ed182dccec223f468f5
ZEGO_AI_AGENT_API_URL=https://aigc-aiagent-api.zegotech.cn

# LLM é…ç½® (ç”± ZEGO æ‰˜ç®¡)
LLM_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
LLM_API_KEY=<é˜¿é‡Œç™¾ç‚¼ API Key>
LLM_MODEL=qwen-plus

# TTS é…ç½® (MiniMax)
TTS_VENDOR=MiniMax
TTS_API_KEY=<MiniMax API Key>
TTS_MODEL=speech-2.6-turbo
```

#### 2.2.3 é…ç½®ç®¡ç†

**é…ç½®æ–‡ä»¶ç»“æ„** (`config/agent-config.json`)
```json
{
  "agentId": "xiaoye_v1",
  "name": "å°å¶",
  "version": "1.0.0",
  "llm": {
    "Vendor": "OpenAIChat", 
    "Url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
    "ApiKey": "<é˜¿é‡Œç™¾ç‚¼ API Key>",
    "Model": "qwen-plus",
    "OutputFormat": {
      "EmotionTagPrefix": "[",
      "EmotionTagSuffix: "]"
    }
  },
  "tts": {
    "Vendor": "MiniMax",
    "Params": {
      "api_key": "<MiniMax API Key>",
      "model": "speech-2.6-turbo",
      "voice_setting": {
        "voice_id": "Congyue",
        "emotion": "neutral"
      }
    },
    "FilterTags": {
      "Enabled": true,
      "Pattern": [
        { "BeginCharacters": "(", "EndCharacters": ")" },
        { "BeginCharacters": "ï¼ˆ", "EndCharacters": "ï¼‰" }
      ]
    }
  },
  "asr": {
    "VADSilenceSegmentation": 500,
    "Params": {
      "hotword_list": "å°å¶|10,ZEGO|10"
    }
  },
  "prompts": {
    "basePath": "config/prompts/",
    "templates": {
      "xiaoye": "xiaoye.xml"
    }
  }
}
```

**é…ç½®åŠ è½½é€»è¾‘** (`lib/config.ts`)
```typescript
import fs from 'fs';
import path from 'path';

interface AgentConfig {
  agentId: string;
  name: string;
  llm: any;
  tts: any;
  asr: any;
  prompts: {
    basePath: string;
    templates: Record<string, string>;
  };
}

export class ConfigManager {
  private static instance: ConfigManager;
  private config: AgentConfig;

  private constructor() {
    const configPath = path.join(process.cwd(), 'config/agent-config.json');
    const configData = fs.readFileSync(configPath, 'utf-8');
    this.config = JSON.parse(configData);
  }

  static getInstance(): ConfigManager {
    if (!ConfigManager.instance) {
      ConfigManager.instance = new ConfigManager();
    }
    return ConfigManager.instance;
  }

  getAgentConfig(): AgentConfig {
    return this.config;
  }

  getPromptPath(templateName: string): string {
    const template = this.config.prompts.templates[templateName];
    if (!template) {
      throw new Error(`Prompt template '${templateName}' not found`);
    }
    return path.join(process.cwd(), this.config.prompts.basePath, template);
  }
}
```

#### 2.2.4 Prompt æ¨¡æ¿ç®¡ç†

**æ¨¡æ¿æ–‡ä»¶** (`config/prompts/xiaoye.xml`)
```xml
<vibe_check>
  # {{CORE_VIBE}}
</vibe_check>

<character_profile>
  <identity>
    {{CHARACTER_IDENTITY}}
  </identity>
  <relationship_evolution>
    {{RELATIONSHIP_HISTORY}}
  </relationship_evolution>
</character_profile>

<interaction_rules>
  <target_user>
    {{USER_PROFILE}}
  </target_user>
  <content_filter>
    {{CONTENT_BOUNDARIES}}
  </content_filter>
</interaction_rules>

<dialogue_parameters>
  <scene_setting>
    ### äº’åŠ¨åœºæ™¯
    - **å½“å‰æ—¶é—´**: {{CURRENT_TIME}}
    - **å½“å‰ä½ç½®**: {{CURRENT_LOCATION}}
  </scene_setting>
  
  <emotional_state>
    ### æƒ…æ„Ÿå‚æ•°
    - **äº²å¯†åº¦**: {{INTIMACY_LEVEL}}
    - **å½“å‰æƒ…ç»ª**: {{CURRENT_MOOD}}
  </emotional_state>
  
  <style_control>
    {{LANGUAGE_STYLE}}
  </style_control>
  
  <output_format>
    ### å¼ºåˆ¶è¾“å‡ºæ ¼å¼
    **æ¯æ¬¡å¯¹è¯å¼€å¤´å¿…é¡»é€‰æ‹©ä¸€ä¸ªæƒ…ç»ªæ ‡ç­¾ç½®é¡¶**ï¼š
    [happy, sad, angry, fearful, disgusted, surprised, calm, fluent, neutral]
  </output_format>
</dialogue_parameters>

<few_shot_examples>
  {{FEW_SHOT_EXAMPLES}}
</few_shot_examples>
```

**Prompt ç®¡ç†å™¨** (`lib/prompt-manager.ts`)
```typescript
import fs from 'fs';
import { ConfigManager } from './config';

interface PromptVariables {
  CURRENT_TIME?: string;
  CURRENT_LOCATION?: string;
  INTIMACY_LEVEL?: string;
  CURRENT_MOOD?: string;
  [key: string]: string | undefined;
}

export class PromptManager {
  private configManager: ConfigManager;

  constructor() {
    this.configManager = ConfigManager.getInstance();
  }

  /**
   * è¯»å– Prompt æ¨¡æ¿
   */
  readTemplate(templateName: string): string {
    const templatePath = this.configManager.getPromptPath(templateName);
    return fs.readFileSync(templatePath, 'utf-8');
  }

  /**
   * æ¸²æŸ“ Promptï¼ˆæ›¿æ¢åŠ¨æ€å‚æ•°ï¼‰
   */
  renderPrompt(templateName: string, variables: PromptVariables): string {
    let template = this.readTemplate(templateName);

    // æ›¿æ¢åŠ¨æ€å˜é‡
    Object.entries(variables).forEach(([key, value]) => {
      const placeholder = `{{${key}}}`;
      template = template.replace(new RegExp(placeholder, 'g'), value || '');
    });

    return template;
  }

  /**
   * è·å–é»˜è®¤å˜é‡ï¼ˆä»ç¯å¢ƒæˆ–é»˜è®¤å€¼ï¼‰
   */
  getDefaultVariables(): PromptVariables {
    return {
      CURRENT_TIME: new Date().toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      }),
      CURRENT_LOCATION: 'å®¶ä¸­æ²™å‘',
      INTIMACY_LEVEL: 'Lv.2 ç†Ÿæ‚‰',
      CURRENT_MOOD: 'neutral',
      // é™æ€å†…å®¹ä»é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“è¯»å–
      CORE_VIBE: 'æ¸©å’Œé€šé€ | å…±æƒ…æ²»æ„ˆ | å‘¨äº”æ™šä¸“å±æ¾å¼›æ„Ÿ',
      CHARACTER_IDENTITY: fs.readFileSync(
        'config/prompts/fragments/character.txt',
        'utf-8'
      ),
      USER_PROFILE: fs.readFileSync(
        'config/prompts/fragments/user-profile.txt',
        'utf-8'
      ),
      // ... å…¶ä»–é™æ€ç‰‡æ®µ
    };
  }

  /**
   * æ›´æ–°åŠ¨æ€å‚æ•°ï¼ˆå¦‚æƒ…ç»ªã€äº²å¯†åº¦ï¼‰
   */
  updateDynamicVariables(
    current: PromptVariables,
    updates: Partial<PromptVariables>
  ): PromptVariables {
    return { ...current, ...updates };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
export function getSystemPrompt(customVariables?: Partial<PromptVariables>): string {
  const promptManager = new PromptManager();
  const defaultVars = promptManager.getDefaultVariables();
  const finalVars = promptManager.updateDynamicVariables(defaultVars, customVariables || {});
  return promptManager.renderPrompt('xiaoye', finalVars);
}
```

**Prompt ç‰‡æ®µç®¡ç†**ï¼ˆæ¨¡å—åŒ–ï¼‰
```
config/prompts/
â”œâ”€â”€ xiaoye.xml              # ä¸»æ¨¡æ¿
â””â”€â”€ fragments/              # å¯å¤ç”¨ç‰‡æ®µ
    â”œâ”€â”€ character.txt       # è§’è‰²è®¾å®š
    â”œâ”€â”€ user-profile.txt    # ç”¨æˆ·ç”»åƒ
    â”œâ”€â”€ content-filter.txt  # å†…å®¹è¾¹ç•Œ
    â”œâ”€â”€ language-style.txt  # è¯­è¨€é£æ ¼
    â””â”€â”€ examples.txt        # Few-shot ç¤ºä¾‹
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ¨¡æ¿ä¸ä»£ç åˆ†ç¦»ï¼Œä¾¿äºéæŠ€æœ¯äººå‘˜è°ƒæ•´
- âœ… åŠ¨æ€å‚æ•°æ›¿æ¢ï¼Œæ”¯æŒä¸ªæ€§åŒ–å®šåˆ¶
- âœ… æ¨¡å—åŒ–ç‰‡æ®µï¼Œä¾¿äºç»„åˆå¤ç”¨
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½ï¼ˆçº¯æ–‡æœ¬æ–‡ä»¶ï¼‰

#### 2.2.5 æ ¸å¿ƒ API å®ç°

**æ³¨å†Œ Agent** (`/api/agent/register`)
```typescript
export async function POST(request: Request) {
  const zegoClient = new ZegoAIAgentClient();
  
  // è¯»å– Prompt æ¨¡æ¿
  const systemPrompt = readPromptTemplate('xiaoye.xml');
  
  const result = await zegoClient.registerAgent({
    AgentId: 'xiaoye_v1',
    Name: 'å°å¶',
    LLM: {
      Vendor: 'OpenAIChat', // å…¼å®¹ OpenAI åè®®
      Url: process.env.LLM_URL,
      ApiKey: process.env.LLM_API_KEY,
      Model: process.env.LLM_MODEL,
      SystemPrompt: systemPrompt
    },
    TTS: {
      Vendor: 'MiniMax',
      Params: {
        api_key: process.env.TTS_API_KEY,
        model: 'speech-2.6-turbo',
        voice_setting: {
          voice_id: 'Congyue',
          emotion: 'neutral'
        }
      }
    },
    ASR: {
    ASR: {
      VADSilenceSegmentation: 500,
      Params: {
        hotword_list: "å°å¶|10,ZEGO|10"
      }
    }
    }
  });
  
  return Response.json(result);
}
```

**åˆ›å»º Agent å®ä¾‹** (`/api/agent/create`)
```typescript
export async function POST(request: Request) {
  const { roomId, userId } = await request.json();
  
  const zegoClient = new ZegoAIAgentClient();
  
  const agentInstanceId = await zegoClient.createAgentInstance({
    AgentId: 'xiaoye_v1',
    UserId: userId,
    RTC: {
      RoomId: roomId,
      AgentUserId: `agent_${Date.now()}`,
      AgentStreamId: `agent_stream_${roomId}`,
      UserStreamId: `user_stream_${userId}`
    },
    MessageHistory: {
      SyncMode: 1, // ä½¿ç”¨ä¼ å…¥çš„æ¶ˆæ¯å†å²
      Messages: [],
      WindowSize: 10
    }
  });
  
  return Response.json({ agentInstanceId });
}
```

### 2.3 æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (v2.0)

#### 2.3.1 è°ƒåº¦ç³»ç»Ÿ (Dispatcher)

**æ¶æ„è®¾è®¡**ï¼š
- **èŒè´£**ï¼šä½œä¸ºåå°é™é»˜ Agentï¼Œè§£æç”¨æˆ·æ„å›¾å¹¶åˆ†å‘ä»»åŠ¡ã€‚
- **è§¦å‘æœºåˆ¶**ï¼šä»…åœ¨äººè®¾ LLM æ— æ³•å¤„ç†æˆ–åˆ¤æ–­éœ€è¦å¤–éƒ¨èƒ½åŠ›æ—¶è°ƒç”¨ï¼ˆå…·ä½“ç­–ç•¥è§åŠŸèƒ½è§„åˆ’ï¼‰ã€‚
- **Prompt æ ¸å¿ƒ**ï¼šåŒ…å«æ„å›¾åˆ†ç±»è§„åˆ™ï¼ˆé—²èŠ/æ¸¸æˆ/æ–°é—»/å¤©æ°”ï¼‰å’Œå‚æ•°æå–é€»è¾‘ã€‚

**æ¥å£è®¾è®¡**ï¼š
```typescript
interface DispatchResult {
  intent: 'chat' | 'game' | 'news_summary' | 'weather';
  confidence: number;
  params: Record<string, any>; // e.g., { gameType: 'turtle_soup' }
}
```

#### 2.3.2 æ¸¸æˆå¼•æ“ (Game Engine)

**çŠ¶æ€æœºç®¡ç†**ï¼š
```typescript
interface GameState {
    type: 'turtle_soup' | 'riddle' | 'idiom_chain';
    status: 'active' | 'paused';
    data: {
        puzzleId: string;
        history: string[]; // æ¸¸æˆå†…çš„å¯¹è¯å†å²
        clues_unlocked: number;
    }
}
```

**ç±»ç»“æ„**ï¼š
- `GameBase`: æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ `start()`, `process(input)`, `end()` æ¥å£ã€‚
- `TurtleSoupGame`: æµ·é¾Ÿæ±¤å®ç°ç±»ï¼ŒåŒ…å«è°œé¢˜åº“åŠ è½½å’Œåˆ¤å®šé€»è¾‘ã€‚
- `RiddleGame`: çŒœè°œå®ç°ç±»ã€‚

**æ•°æ®æµè½¬**ï¼š
1. Dispatcher è¯†åˆ«æ„å›¾ `start_game` â†’ GameManager åˆ›å»ºæ¸¸æˆå®ä¾‹
2. ç”¨æˆ·è¯­éŸ³è¾“å…¥ â†’ GameManager è·¯ç”±åˆ°å½“å‰æ¿€æ´»çš„æ¸¸æˆ
3. æ¸¸æˆé€»è¾‘å¤„ç† â†’ è¿”å› `GameFeedback` (Prompt ç‰‡æ®µ) â†’ æ›´æ–° Persona LLM ä¸Šä¸‹æ–‡


---

## 3. å…³é”®æŠ€æœ¯ç‚¹

### 3.1 éŸ³é¢‘æµç®¡ç†

#### æ¨æµé…ç½®
```javascript
// ZEGO Express SDK æœ€ä½³å®è·µ
zegoEngine.setAudioConfig({
  bitrate: 48,        // 48 kbps
  channel: 1,         // å•å£°é“
  codecID: 2          // Opus ç¼–ç 
});

// éŸ³é¢‘è´¨é‡ä¼˜åŒ–
zegoEngine.enableAEC(true);   // å›å£°æ¶ˆé™¤
zegoEngine.enableANS(true);   // å™ªå£°æŠ‘åˆ¶
zegoEngine.enableAGC(true);   // è‡ªåŠ¨å¢ç›Š
```

### 3.2 å­—å¹•æµå¼å±•ç¤º

#### æ–¹æ¡ˆé€‰æ‹©
- **ZEGO å­—å¹•ç»„ä»¶**: ä½¿ç”¨ ZEGO å®˜æ–¹æä¾›çš„å­—å¹•å¤„ç†ç±»ï¼Œæ”¯æŒå®æ—¶å­—å¹•å±•ç¤ºå’Œå†å²æ¶ˆæ¯æŒä¹…åŒ–
- **æ— éœ€ ZIM SDK**: å­—å¹•ç»„ä»¶å·²ç»å°è£…äº†æ¶ˆæ¯ç®¡ç†é€»è¾‘

#### å®ç°ç¤ºä¾‹
```typescript
// ä» ZEGO æ–‡æ¡£ä¸‹è½½å­—å¹•å¤„ç†ç±»
import { ZegoSubtitleManager } from '@/lib/zego-subtitle';

// åˆå§‹åŒ–å­—å¹•ç®¡ç†å™¨
const subtitleManager = new ZegoSubtitleManager({
  appID: APP_ID,
  roomID: roomId,
});

// ç›‘å¬å­—å¹•äº‹ä»¶
subtitleManager.on('subtitleUpdate', (subtitle) => {
  // subtitle: { type: 'user' | 'agent', text: string, timestamp: number }
  setSubtitles(prev => [...prev, subtitle]);
});

// React Hook å°è£…
function useSubtitle(roomId: string) {
  const [subtitles, setSubtitles] = useState([]);
  
  useEffect(() => {
    const manager = new ZegoSubtitleManager({ appID: APP_ID, roomID: roomId });
    manager.on('subtitleUpdate', (subtitle) => {
      setSubtitles(prev => [...prev, subtitle]);
    });
    return () => manager.destroy();
  }, [roomId]);
  
  return subtitles;
}
```

> **æ³¨æ„**: ZEGO å­—å¹•å¤„ç†ç±»å¯ä»å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹ä»£ç ä¸­è·å–ï¼Œç›´æ¥é›†æˆå³å¯ï¼Œæ— éœ€é‡æ–°å¼€å‘ã€‚

#### æƒ…ç»ªæ ‡ç­¾é€ä¼ 

**æœºåˆ¶è¯´æ˜**ï¼š
- LLM ç”Ÿæˆçš„æ–‡æœ¬åŒ…å«æƒ…ç»ªæ ‡ç­¾ï¼ˆå¦‚ `[happy] ä½ å¥½å‘€`ï¼‰
- ZEGO AI Agent é€šè¿‡å­—å¹•æ¶ˆæ¯é€ä¼ å®Œæ•´æ–‡æœ¬ï¼ˆåŒ…å«æƒ…ç»ªæ ‡ç­¾ï¼‰
- TTS é…ç½®äº†è¿‡æ»¤æ ‡ç­¾ï¼Œæœ—è¯»æ—¶è‡ªåŠ¨å»é™¤ `[happy]` éƒ¨åˆ†
- å‰ç«¯ä»å­—å¹•ä¸­è§£ææƒ…ç»ªæ ‡ç­¾å¹¶æ›´æ–° UI

**å‰ç«¯å®ç°**ï¼š
```typescript
// è§£æå­—å¹•ä¸­çš„æƒ…ç»ªæ ‡ç­¾
function parseEmotion(text: string): { emotion: string, cleanText: string } {
  const emotionRegex = /^\[([^\]]+)\]\s*/;
  const match = text.match(emotionRegex);
  
  if (match) {
    return {
      emotion: match[1],  // 'happy', 'sad', 'tender' ç­‰
      cleanText: text.replace(emotionRegex, '')  // ç§»é™¤æƒ…ç»ªæ ‡ç­¾åçš„æ–‡æœ¬
    };
  }
  
  return { emotion: 'neutral', cleanText: text };
}

// åœ¨å­—å¹•äº‹ä»¶ç›‘å¬ä¸­ä½¿ç”¨
subtitleManager.on('subtitleUpdate', (subtitle) => {
  if (subtitle.type === 'agent') {
    const { emotion, cleanText } = parseEmotion(subtitle.text);
    
    // æ›´æ–°æƒ…ç»ªæ ‡ç­¾ UI
    setCurrentEmotion(emotion);
    
    // æ˜¾ç¤ºå»é™¤æƒ…ç»ªæ ‡ç­¾åçš„æ–‡æœ¬
    setSubtitles(prev => [...prev, { ...subtitle, text: cleanText }]);
  }
});
```

### 3.3 Agent çŠ¶æ€ç®¡ç†

#### çŠ¶æ€è·å–æ–¹å¼

Agent çš„å®æ—¶çŠ¶æ€é€šè¿‡ **ZEGO æˆ¿é—´ä¿¡ä»¤** è·å–ï¼Œè€Œéå‰ç«¯çŒœæµ‹ã€‚

**çŠ¶æ€ç±»å‹**ï¼š
- `idle`: ç©ºé—²ä¸­ ğŸ”µ
- `listening`: å€¾å¬ä¸­ ğŸ‘‚
- `thinking`: æ€è€ƒä¸­ ğŸ§ 
- `speaking`: è¯´è¯ä¸­ ğŸ’¬

**å®ç°ç¤ºä¾‹**ï¼š
```typescript
// ç›‘å¬æ¥æ”¶å®éªŒæ€§ API å›è°ƒ (recvExperimentalAPI)
// å¿…é¡»å…ˆè°ƒç”¨ zg.callExperimentalAPI({ method: 'onRecvRoomChannelMessage', params: {} });
zg.on('recvExperimentalAPI', (result) => {
  if (result.method === 'onRecvRoomChannelMessage') {
    const recvMsg = JSON.parse(result.content.msgContent);
    const { Cmd, Data } = recvMsg;
    
    // Cmd=6: æ™ºèƒ½ä½“å®ä¾‹çŠ¶æ€æ›´æ–°
    if (Cmd === 6) {
      // Data.Status: 0=idle, 1=listening, 2=thinking, 3=speaking
      const statusMap = { 0: 'idle', 1: 'listening', 2: 'thinking', 3: 'speaking' };
      setAgentStatus(statusMap[Data.Status]);
    }
  }
});

// æˆ–ä½¿ç”¨ ZEGO AI Agent SDK çš„çŠ¶æ€å›è°ƒï¼ˆå¦‚æœæ”¯æŒï¼‰
agentSDK.on('statusChange', (status) => {
  setAgentStatus(status);  // 'idle' | 'listening' | 'thinking' | 'speaking'
});
```

**çŠ¶æ€åˆ° UI çš„æ˜ å°„**ï¼š
```typescript
const statusConfig = {
  idle: { icon: 'ğŸ”µ', text: 'ç©ºé—²ä¸­' },
  listening: { icon: 'ğŸ‘‚', text: 'å€¾å¬ä¸­...' },
  thinking: { icon: 'ğŸ§ ', text: 'æ€è€ƒä¸­...' },
  speaking: { icon: 'ğŸ’¬', text: 'è¯´è¯ä¸­' }
};

function StatusBadge({ status }: { status: AgentStatus }) {
  const config = statusConfig[status];
  return (
    <div className="flex items-center gap-2">
      <span className="status-dot animate-pulse" />
      <span>{config.icon} {config.text}</span>
    </div>
  );
}
```

**æƒ…ç»ªæ˜¾ç¤ºæ˜ å°„**ï¼š
```typescript
// å‰ç«¯å°†è‹±æ–‡æƒ…ç»ªå€¼æ˜ å°„ä¸ºä¸­æ–‡æ˜¾ç¤º
const EMOTION_MAP: Record<string, string> = {
    happy: 'ğŸ˜Š å¼€å¿ƒ',
    sad: 'ğŸ˜¢ éš¾è¿‡',
    angry: 'ğŸ˜  ç”Ÿæ°”',
    fearful: 'ğŸ˜¨ å®³æ€•',
    surprised: 'ğŸ˜² æƒŠè®¶',
    neutral: 'ğŸ˜Œ å¹³é™'
};

// ä» LLM è¾“å‡º [[{"emotion":"happy"}]] ä¸­æå–æƒ…ç»ªå€¼
const emotionMatch = text.match(/\[\[\{"emotion":"([^"]+)"\}\]\]/);
const emotion = emotionMatch ? emotionMatch[1] : 'neutral';

// UI æ˜¾ç¤º
<span>{EMOTION_MAP[emotion]}</span>
```
```

### 3.4 éŸ³æµªåŠ¨ç”»

å·²åœ¨åŸå‹å®ç°çºµæ³¢æ•ˆæœï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´æ¯æ ¹ `wave-bar` çš„é«˜åº¦å®ç°å£°éŸ³å¯è§†åŒ–ã€‚

### 3.4 æ™ºèƒ½æ»šåŠ¨

```javascript
let autoScrollEnabled = true;

subtitleArea.addEventListener('scroll', () => {
  const isAtBottom = 
    subtitleArea.scrollHeight - subtitleArea.scrollTop - subtitleArea.clientHeight < 30;
  autoScrollEnabled = isAtBottom;
});

function scrollToBottom() {
  if (autoScrollEnabled) {
    subtitleArea.scrollTop = subtitleArea.scrollHeight;
  }
}
```

### 3.6 TTS é«˜çº§é…ç½®å®ç°

#### æ‹¬å·è¿‡æ»¤ (FilterText)
ZEGO AI Agent API çš„ `FilterText` å‚æ•°éœ€è¦ä¸¥æ ¼çš„å¯¹è±¡æ•°ç»„æ ¼å¼ï¼Œä¸æ”¯æŒæ­£åˆ™å­—ç¬¦ä¸²ã€‚
**å®ç°ä»£ç ** (`/api/agent/create`):
```typescript
FilterText: [
  { BeginCharacters: '(', EndCharacters: ')' },
  { BeginCharacters: 'ï¼ˆ', EndCharacters: 'ï¼‰' },
  { BeginCharacters: '[', EndCharacters: ']' },
  { BeginCharacters: 'ã€', EndCharacters: 'ã€‘' }
]
```

#### æƒ…ç»ªæ ‡ç­¾æ§åˆ¶
MiniMax TTS å¼•æ“é€šè¿‡ ZEGO AI Agent çš„ AdvancedConfig æœºåˆ¶æ§åˆ¶æƒ…ç»ªï¼Œéœ€ä½¿ç”¨åŒé‡æ–¹æ‹¬å·åŒ…è£¹çš„ JSONã€‚

**å…³é”®é—®é¢˜**ï¼šZEGO ä¼šè‡ªåŠ¨è¿‡æ»¤ `[[{"emotion":"..."}]]` æ ‡ç­¾ï¼Œå¯¼è‡´å‰ç«¯æ— æ³•ä»å­—å¹•ä¸­è·å–æƒ…ç»ªä¿¡æ¯ã€‚

**è§£å†³æ–¹æ¡ˆ - åŒæ ‡ç­¾æœºåˆ¶**:
```xml
<output_format>
  - TTS æ§åˆ¶æ ‡ç­¾ï¼š[[{"emotion":"æƒ…ç»ªå€¼"}]]ï¼ˆè¢« ZEGO è¿‡æ»¤ï¼Œä»…ç”¨äº TTSï¼‰
  - å‰ç«¯æ˜¾ç¤ºæ ‡ç­¾ï¼š(æƒ…ç»ªå€¼)ï¼ˆä¸è¢«è¿‡æ»¤ï¼Œç”¨äºå‰ç«¯æå–ï¼‰
  - å®Œæ•´æ ¼å¼ï¼š[[{"emotion":"happy"}]] (happy) å¯¹è¯å†…å®¹
</output_format>
```

**å®ç°ç»†èŠ‚**: 
1. **Prompt è¦æ±‚**ï¼šLLM å¿…é¡»åŒæ—¶è¾“å‡ºä¸¤ç§æ ‡ç­¾
2. **TTS å¤„ç†**ï¼šZEGO æå– `[[{"emotion":"..."}]]` æ§åˆ¶è¯­éŸ³æƒ…ç»ªï¼Œç„¶åå°†å…¶è¿‡æ»¤
3. **å‰ç«¯æå–**ï¼šä» `(happy)` ä¸­æå–æƒ…ç»ªå€¼å¹¶æ˜ å°„ä¸ºä¸­æ–‡æ˜¾ç¤º
4. **å­—å¹•æ¸…ç†**ï¼šç§»é™¤ `(happy)` æ˜¾ç¤ºæ ‡ç­¾ï¼Œåªä¿ç•™çº¯æ–‡æœ¬

**å‰ç«¯æƒ…ç»ªæå–**:
```typescript
// ä»æ˜¾ç¤ºæ ‡ç­¾æå–æƒ…ç»ªï¼ˆZEGOå·²è¿‡æ»¤TTSæ ‡ç­¾ï¼‰
const emotionMatch = text.match(/\(([a-z]+)\)/);
const emotion = emotionMatch ? emotionMatch[1] : 'neutral';

// æ˜ å°„ä¸ºä¸­æ–‡æ˜¾ç¤º
const EMOTION_MAP = {
    happy: 'ğŸ˜Š å¼€å¿ƒ',
    sad: 'ğŸ˜¢ éš¾è¿‡',
    // ...
};
```

---

## 4. æ•°æ®æµè½¬

### 4.1 é€šè¯å»ºç«‹æµç¨‹

```
ç”¨æˆ·                å‰ç«¯ H5             åç«¯ Next.js         ZEGO äº‘æœåŠ¡
  â”‚                  â”‚                    â”‚                      â”‚
  â”œâ”€ç‚¹å‡»é€šè¯æŒ‰é’®â”€â”€â”€â”€â†’â”‚                    â”‚                      â”‚
  â”‚                  â”œâ”€POST /api/token â”€â”€â†’â”‚                      â”‚
  â”‚                  â”‚â†â”€ userId + token â”€â”€â”¤                      â”‚
  â”‚                  â”œâ”€loginRoom()â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
  â”‚                  â”œâ”€startPublish()â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
  â”‚                  â”œâ”€POST /api/create â”€â”€â†’â”‚                      â”‚
  â”‚                  â”‚                    â”œâ”€CreateAgentInstanceâ†’ â”‚
  â”‚                  â”‚                    â”‚                      â”œâ”€Agent åŠ å…¥æˆ¿é—´
  â”‚                  â”‚                    â”‚â†â”€agentInstanceId â”€â”€â”€â”¤
  â”‚                  â”‚â†â”€agentInstanceId â”€â”€â”¤                      â”‚
  â”‚                  â”œâ”€ç›‘å¬æµäº‹ä»¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
  â”‚                  â”‚â†â”€æ‹‰ Agent æµ â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
  â”‚â†â”€å¬åˆ° AI è¯´è¯â”€â”€â”€â”¤                    â”‚                      â”‚
```

### 4.2 æ¶ˆæ¯æµè½¬

```
ç”¨æˆ·è¯´è¯ â†’ Express SDK (ASR) â†’ ZEGO AI Agent â†’ LLM â†’ TTS â†’ è¯­éŸ³æµ â†’ ç”¨æˆ·å¬åˆ°
                                     â†“
                                  ZIM SDK
                                     â†“
                             å­—å¹•æ¶ˆæ¯æŒä¹…åŒ–
                                     â†“
                      å‰ç«¯ç›‘å¬æ¶ˆæ¯ â†’ å±•ç¤ºå­—å¹•

### 4.3 è¯¦ç»†äº¤äº’æ—¶åº (Proactive & Silence)

```mermaid
sequenceDiagram
    participant U as User
    participant FE as Frontend (CallPage/Hooks)
    participant ZE as ZEGO RTC
    participant BE as Backend (Next.js)

    Note over U, BE: 1. ä¸»åŠ¨é—®å€™
    U->>FE: è¿›å…¥é€šè¯é¡µé¢
    FE->>ZE: ç™»å½•æˆ¿é—´ & æ‹‰æµ
    ZE-->>FE: onPlayerStateUpdate (Agent Stream PLAYING)
    FE->>BE: POST /api/agent/talk-first (silenceLevel='welcome')
    BE->>BE: Load Agent Config
    BE->>ZE: SendAgentInstanceLLM (Welcome Prompt)
    ZE->>U: æ’­æ”¾æ¬¢è¿è¯­
    
    Note over U, BE: 2. æ²‰é»˜æ£€æµ‹ (Event Driven)
    ZE-->>FE: recvExperimentalAPI (Cmd=6, Status=3 Speaking)
    FE->>FE: Stop Timer
    ZE->>U: AI æ­£åœ¨è¯´è¯...
    ZE-->>FE: recvExperimentalAPI (Cmd=6, Status=1 Listening/0 Idle)
    FE->>FE: Start Timer (count from 0)
    
    rect rgb(240, 240, 240)
        Note right of FE: Timer waits 5s (Short)
        FE->>FE: Timer Fired (Short)
        FE->>BE: POST /api/agent/talk-first (silenceLevel='short')
        BE->>ZE: SendAgentInstanceLLM (Short Prompt)
        ZE->>U: AI: "ä½ åœ¨å¬å—ï¼Ÿ"
    end

    ZE-->>FE: recvExperimentalAPI (Cmd=6, Status=3 Speaking)
    FE->>FE: Stop Timer (Mark Proactive Trigger)
    ZE-->>FE: recvExperimentalAPI (Cmd=6, Status=1 Listening)
    FE->>FE: Start Timer (Preserve Levels -> Next: Medium)

    rect rgb(240, 240, 240)
        Note right of FE: Timer waits 15s (Medium)
        FE->>FE: Timer Fired (Medium)
        FE->>BE: POST /api/agent/talk-first (silenceLevel='medium')
    end
    
    Note over U, FE: User Speaks (Break Chain)
    U->>ZE: Speaking...
    ZE-->>FE: recvExperimentalAPI (Cmd=1, SpeakStatus=1 Start)
    FE->>FE: Stop Timer & Clear Trigger Flags
```    
    Note over U, BE: 2. æ²‰é»˜æ£€æµ‹
    loop Silence Detection
        U->>FE: åœæ­¢è¯´è¯ / AI åœæ­¢è¯´è¯
        FE->>FE: Start Timer (5s, 15s, 30s)
        
        alt 5s Silence
            FE->>BE: POST /api/agent/talk-first (silenceLevel='short')
            BE->>ZE: SendAgentInstanceLLM (Short Prompt)
        else 15s Silence
            FE->>BE: POST /api/agent/talk-first (silenceLevel='medium')
            BE->>ZE: SendAgentInstanceLLM (Medium Prompt)
        else 30s Silence (Recurring)
            FE->>BE: POST /api/agent/talk-first (silenceLevel='long')
            BE->>ZE: SendAgentInstanceLLM (Long Prompt)
        end
        
        U->>FE: User Speaks
        FE->>FE: Reset Timer
    end
```
```

---

## 5. å®‰å…¨ä¸æ€§èƒ½

### 5.1 é‰´æƒæ–¹æ¡ˆ

- **Token é‰´æƒ**: ä½¿ç”¨ ZEGO AppSign ç”Ÿæˆå®¢æˆ·ç«¯ Token
- **API ç­¾å**: æœåŠ¡ç«¯è°ƒç”¨ ZEGO AI Agent API ä½¿ç”¨ç­¾åæœºåˆ¶
- **ç¯å¢ƒå˜é‡éš”ç¦»**: æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨ `.env.local`

### 5.2 æ€§èƒ½ä¼˜åŒ–

- **æ‡’åŠ è½½**: SDK æŒ‰éœ€åŠ è½½
- **è¿æ¥æ± **: å¤ç”¨ HTTP è¿æ¥
- **ç¼“å­˜ç­–ç•¥**: Agent é…ç½®ç¼“å­˜åˆ°å†…å­˜
- **æ–­çº¿é‡è¿**: Express SDK è‡ªåŠ¨é‡è¿

---

## 6. éƒ¨ç½²æ–¹æ¡ˆ

### 6.1 å¼€å‘ç¯å¢ƒ

```bash
# å‰ç«¯
cd Prototype
# ä½¿ç”¨æœ¬åœ° HTTP æœåŠ¡å™¨è¿è¡Œ
python3 -m http.server 8080

# åç«¯
cd server
npm install
npm run dev  # é»˜è®¤ç«¯å£ 3000
```

### 6.2 ç”Ÿäº§ç¯å¢ƒ (æ¨è)

- **Vercel**: ä¸€é”®éƒ¨ç½² Next.js
- **Cloudflare Pages**: é™æ€ H5 æ‰˜ç®¡
- **è‡ªå»ºæœåŠ¡å™¨**: Nginx + Node.js

---
---

## 5. é«˜çº§åŠŸèƒ½å®ç° (2026-01-08 æ–°å¢)

### 5.1 åŠŸèƒ½é…ç½®ç®¡ç†ç³»ç»Ÿ

#### 5.1.1 è®¾è®¡ç›®æ ‡

å»ºç«‹ç»Ÿä¸€çš„å®éªŒæ€§åŠŸèƒ½é…ç½®ä¸­å¿ƒï¼Œæ”¯æŒï¼š
- âœ… åŠŸèƒ½å¼€å…³æ§åˆ¶
- âœ… å‚æ•°åŒ–é…ç½®
- âœ… çƒ­æ›´æ–°æ”¯æŒ
- âœ… ç‰ˆæœ¬è¿½è¸ª

#### 5.1.2 é…ç½®æ–‡ä»¶ç»“æ„

**é…ç½®æ–‡ä»¶** (`config/features.json`)
```json
{
  "version": "1.0.0",
  "last_updated": "2026-01-08T15:47:41+08:00",
  "description": "IdealAICompanion å®éªŒæ€§åŠŸèƒ½é…ç½®ä¸­å¿ƒ",
  "features": {
    "dynamic_scene_context": {
      "enabled": true,
      "description": "åŠ¨æ€åœºæ™¯æ¨æ–­",
      "default": false,
      "config": {
        "use_user_profile": true,
        "time_based_inference": true,
        "weekend_detection": true
      }
    },
    "persona_evolution": {
      "enabled": true,
      "description": "ç”¨æˆ·ç”»åƒè‡ªåŠ¨å­¦ä¹ ",
      "config": {
        "trigger_interval_seconds": 60,
        "trigger_turn_count": 10,
        "hot_update_enabled": true
      }
    }
  },
  "experimental": {
    "description": "å®éªŒæ€§åŠŸèƒ½ï¼Œéšæ—¶å¯èƒ½è°ƒæ•´æˆ–ç§»é™¤",
    "features": {}
  }
}
```

#### 5.1.3 FeatureManager å®ç°

**æ ¸å¿ƒç±»** (`lib/feature-manager.ts`)
```typescript
interface FeaturesData {
  version: string;
  last_updated: string;
  features: Record<string, Feature>;
  experimental?: {
    features: Record<string, Feature>;
  };
}

interface Feature {
  enabled: boolean;
  description: string;
  default: boolean;
  config?: Record<string, any>;
}

export class FeatureManager {
  private static instance: FeatureManager;
  private config: FeaturesData;
  private configPath: string;

  private constructor() {
    this.configPath = path.join(process.cwd(), 'config/features.json');
    this.config = this.loadConfig();
  }

  static getInstance(): FeatureManager {
    if (!FeatureManager.instance) {
      FeatureManager.instance = new FeatureManager();
    }
    return FeatureManager.instance;
  }

  /**
   * æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
   */
  isEnabled(featureName: string): boolean {
    const feature = this.config.features[featureName];
    if (!feature) {
      const experimentalFeature = this.config.experimental?.features[featureName];
      return experimentalFeature?.enabled ?? false;
    }
    return feature.enabled ?? false;
  }

  /**
   * è·å–åŠŸèƒ½é…ç½®å‚æ•°
   */
  getFeatureConfig(featureName: string): any {
    const feature = this.config.features[featureName];
    if (!feature) {
      const experimentalFeature = this.config.experimental?.features[featureName];
      return experimentalFeature?.config ?? {};
    }
    return feature.config ?? {};
  }

  /**
   * åŠ¨æ€åˆ‡æ¢åŠŸèƒ½å¼€å…³
   */
  toggleFeature(featureName: string, enabled: boolean): void {
    if (this.config.features[featureName]) {
      this.config.features[featureName].enabled = enabled;
      this.persistConfig();
    }
  }

  /**
   * é‡æ–°åŠ è½½é…ç½®ï¼ˆçƒ­æ›´æ–°ï¼‰
   */
  reload(): void {
    this.config = this.loadConfig();
  }

  private loadConfig(): FeaturesData {
    try {
      const content = fs.readFileSync(this.configPath, 'utf-8');
      return JSON.parse(content);
    } catch (error) {
      console.error('[FeatureManager] Failed to load config:', error);
      return this.getDefaultConfig();
    }
  }

  private persistConfig(): void {
    try {
      this.config.last_updated = new Date().toISOString();
      fs.writeFileSync(this.configPath, JSON.stringify(this.config, null, 2));
    } catch (error) {
      console.error('[FeatureManager] Failed to persist config:', error);
    }
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
const featureManager = FeatureManager.getInstance();

// æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
if (featureManager.isEnabled('dynamic_scene_context')) {
  const scene = generateSceneContext(userProfile);
}

// è·å–åŠŸèƒ½é…ç½®
const config = featureManager.getFeatureConfig('persona_evolution');
const triggerInterval = config.trigger_interval_seconds;

// åŠ¨æ€åˆ‡æ¢åŠŸèƒ½
featureManager.toggleFeature('dynamic_scene_context', false);
```

---

### 5.2 åŠ¨æ€åœºæ™¯ä¸Šä¸‹æ–‡

#### 5.2.1 åŠŸèƒ½æ¦‚è¿°

æ ¹æ®**å®æ—¶æ—¶é—´**ã€**æ˜ŸæœŸå‡ **å’Œ**ç”¨æˆ·ç”»åƒ**åŠ¨æ€æ¨æ–­åœºæ™¯ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨è°ƒæ•´ AI çš„å¯¹è¯åœºæ™¯è®¾å®šã€‚

**æ•ˆæœå¯¹æ¯”**ï¼š
- **é™æ€åœºæ™¯**: "å½“å‰æ—¶é—´: 2026å¹´1æœˆ8æ—¥ï¼Œå½“å‰ä½ç½®: å®¶ä¸­æ²™å‘"ï¼ˆå›ºå®šï¼‰
- **åŠ¨æ€åœºæ™¯**: "å½“å‰æ—¶é—´: 2026å¹´1æœˆ8æ—¥ å‘¨å›› 16:14ï¼Œå½“å‰ä½ç½®: åŠå…¬å®¤æˆ–ä¸‹ç­è·¯ä¸Š"ï¼ˆæ ¹æ®æ—¶é—´æ™ºèƒ½æ¨æ–­ï¼‰

#### 5.2.2 åœºæ™¯æ¨æ–­ç®—æ³•

**æ¨æ–­ç»´åº¦**ï¼š
1. **æ—¶é—´æ®µ**: æ—©æ™¨/ä¸Šåˆ/ä¸­åˆ/ä¸‹åˆ/å‚æ™š/æ™šä¸Š/æ·±å¤œ
2. **æ˜ŸæœŸå‡ **: å·¥ä½œæ—¥/å‘¨æœ«
3. **ç‰¹æ®Šæ—¶æ®µ**: å‘¨äº”æ™šä¸Šï¼ˆå‘¨æœ«å‰å¤•ï¼‰
4. **ç”¨æˆ·ç”»åƒ**: åŠ ç­ä¹ æƒ¯ã€ä½œæ¯è§„å¾‹

**æ—¶é—´æ®µæ˜ å°„è¡¨**ï¼š
| æ—¶é—´æ®µ | å·¥ä½œæ—¥åœ°ç‚¹ | å·¥ä½œæ—¥æ°›å›´ | å‘¨æœ«åœ°ç‚¹ | å‘¨æœ«æ°›å›´ |
|--------|-----------|-----------|----------|----------|
| 6:00-8:59 | å®¶ä¸­æˆ–é€šå‹¤è·¯ä¸Š | å‡†å¤‡ä¸Šç­ | å®¶ä¸­ | å‘¨æœ«æ—©æ™¨ |
| 9:00-11:59 | åŠå…¬å®¤ | å·¥ä½œä¸­ | å®¶ä¸­ | å‘¨æœ«ä¸Šåˆ |
| 12:00-13:59 | åŠå…¬å®¤æˆ–é¤å… | åˆé¤ä¼‘æ¯ | å®¶ä¸­ | å‘¨æœ«åˆå |
| 14:00-16:59 | åŠå…¬å®¤ | å¿™ç¢Œå·¥ä½œä¸­ | å®¶ä¸­ | å‘¨æœ«ä¸‹åˆ |
| 17:00-20:59 | åŠå…¬å®¤æˆ–ä¸‹ç­è·¯ä¸Š | å‡†å¤‡ä¸‹ç­ | å®¶ä¸­ | å‘¨æœ«å¤œæ™š |
| 21:00-22:59 | å®¶ä¸­ | å¤œæ™šæ”¾æ¾ | å®¶ä¸­ | å‘¨æœ«å¤œæ™š |
| 23:00-5:59 | å®¶ä¸­ | æ·±å¤œæ…°è—‰ | å®¶ä¸­ | æ·±å¤œæ…°è—‰ |

**ç‰¹æ®Šè§„åˆ™**ï¼š
- **å‘¨äº”æ™šä¸Š 18:00-23:00**: åœ°ç‚¹"å®¶ä¸­"ï¼Œæ°›å›´"å‘¨æœ«å‰å¤•ï¼Œæ”¾æ¾å¨±ä¹"
- **åŠ ç­ç”¨æˆ· + å·¥ä½œæ—¥ 21:00-23:00**: åœ°ç‚¹"å¯èƒ½è¿˜åœ¨åŠ ç­"ï¼Œæ°›å›´"åŠ ç­è¾›è‹¦"

#### 5.2.3 å®ç°ä»£ç 

**åœºæ™¯ç”Ÿæˆå‡½æ•°** (`lib/prompt-manager.ts`)
```typescript
generateSceneContext(userProfile?: any): {
  currentTime: string;
  location: string;
  interactionGoal: string;
} {
  const now = new Date();
  const hour = now.getHours();
  const day = now.getDay(); // 0=å‘¨æ—¥, 1-6=å‘¨ä¸€åˆ°å‘¨å…­
  const isWeekend = day === 0 || day === 6;
  const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];

  // æ ¼å¼åŒ–æ—¶é—´
  const currentTime = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ ${dayNames[day]} ${hour.toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

  // åŸºç¡€æ¨æ–­
  let location = 'å®¶ä¸­';
  let atmosphere = 'æ—¥å¸¸é—²èŠ';

  // æ—¶é—´æ®µæ¨æ–­ï¼ˆ7ä¸ªæ—¶é—´æ®µï¼‰
  if (hour >= 6 && hour < 9) {
    location = !isWeekend ? 'å®¶ä¸­æˆ–é€šå‹¤è·¯ä¸Š' : 'å®¶ä¸­';
    atmosphere = !isWeekend ? 'å‡†å¤‡ä¸Šç­' : 'å‘¨æœ«æ—©æ™¨';
  } else if (hour >= 9 && hour < 12) {
    location = !isWeekend ? 'åŠå…¬å®¤' : 'å®¶ä¸­';
    atmosphere = !isWeekend ? 'å·¥ä½œä¸­' : 'å‘¨æœ«ä¸Šåˆ';
  } else if (hour >= 12 && hour < 14) {
    location = !isWeekend ? 'åŠå…¬å®¤æˆ–é¤å…' : 'å®¶ä¸­';
    atmosphere = !isWeekend ? 'åˆé¤ä¼‘æ¯' : 'å‘¨æœ«åˆå';
  } else if (hour >= 14 && hour < 17) {
    location = !isWeekend ? 'åŠå…¬å®¤' : 'å®¶ä¸­';
    atmosphere = !isWeekend ? 'å¿™ç¢Œå·¥ä½œä¸­' : 'å‘¨æœ«ä¸‹åˆ';
  } else if (hour >= 17 && hour < 21) {
    // ä¸‹ç­æ—¶æ®µï¼š17:00-20:59
    if (!isWeekend) {
      location = hour < 19 ? 'åŠå…¬å®¤æˆ–ä¸‹ç­è·¯ä¸Š' : 'å®¶ä¸­';
      atmosphere = hour < 19 ? 'å‡†å¤‡ä¸‹ç­' : 'ä¸‹ç­æ”¾æ¾';
    } else {
      location = 'å®¶ä¸­';
      atmosphere = 'å‘¨æœ«å¤œæ™š';
    }
    // ç‰¹æ®Šï¼šå‘¨äº”æ™šä¸Š
    if (day === 5 && hour >= 18) {
      location = 'å®¶ä¸­';
      atmosphere = 'å‘¨æœ«å‰å¤•ï¼Œæ”¾æ¾å¨±ä¹';
    }
  } else if (hour >= 21 && hour < 23) {
    location = 'å®¶ä¸­';
    atmosphere = day === 5 ? 'å‘¨æœ«å‰å¤•ï¼Œæ”¾æ¾å¨±ä¹' : 'å¤œæ™šæ”¾æ¾';
  } else {
    location = 'å®¶ä¸­';
    atmosphere = 'æ·±å¤œæ…°è—‰';
  }

  // ç”¨æˆ·ç”»åƒå¢å¼º
  if (userProfile?.work_habit?.includes('overtime')) {
    // åŠ ç­ç”¨æˆ·ï¼šå·¥ä½œæ—¥æ™šä¸Šå¯èƒ½è¿˜åœ¨åŠå…¬å®¤
    if (!isWeekend && hour >= 21 && hour <= 23) {
      location = 'å¯èƒ½è¿˜åœ¨åŠ ç­';
      atmosphere = 'åŠ ç­è¾›è‹¦';
    }
    if (!isWeekend && hour >= 23) {
      location = 'åˆšåŠ ç­å›å®¶';
      atmosphere = 'æ·±å¤œç–²æƒ«';
    }
  }

  return { currentTime, location, interactionGoal: atmosphere };
}
```

#### 5.2.4 é›†æˆæµç¨‹

**1. æå–ç”¨æˆ·ç”»åƒ** (`app/api/agent/create/route.ts`)
```typescript
function extractUserProfile(templateName: string): any {
  const promptPath = path.join(process.cwd(), 'config/prompts', templateName);
  const content = fs.readFileSync(promptPath, 'utf-8');
  
  // æå– <target_user> æ ‡ç­¾
  const regex = /<target_user>([\s\S]*?)<\/target_user>/;
  const match = content.match(regex);
  
  if (match) {
    const parsed = JSON.parse(match[1].trim());
    return parsed.user_profile || parsed;
  }
  return undefined;
}
```

**2. ç”Ÿæˆåœºæ™¯å¹¶æ›¿æ¢å ä½ç¬¦** (`lib/prompt-manager.ts`)
```typescript
generateFinalPrompt(templateFilename: string, overrides = {}, userProfile?: any): string {
  const template = fs.readFileSync(templatePath, 'utf-8');
  
  // æ£€æŸ¥åŠŸèƒ½å¼€å…³
  const featureManager = FeatureManager.getInstance();
  if (featureManager.isEnabled('dynamic_scene_context')) {
    const scene = this.generateSceneContext(userProfile);
    
    return template
      .replace('{{CURRENT_TIME}}', scene.currentTime)
      .replace('{{LOCATION}}', scene.location)
      .replace('{{INTERACTION_GOAL}}', scene.interactionGoal);
  }
  
  // åŠŸèƒ½å…³é—­æ—¶ä½¿ç”¨é™æ€é»˜è®¤å€¼
  return template
    .replace('{{CURRENT_TIME}}', 'å½“å‰æ—¶é—´')
    .replace('{{LOCATION}}', 'å®¶ä¸­æ²™å‘')
    .replace('{{INTERACTION_GOAL}}', 'æ—¥å¸¸é—²èŠ');
}
```

**3. Agent åˆ›å»ºæ—¶è°ƒç”¨** (`app/api/agent/create/route.ts`)
```typescript
const userProfile = extractUserProfile(config.prompt.template);
const systemPrompt = getSystemPrompt(config.prompt.template, {}, userProfile);
```

---

### 5.3 Prompt ä¼˜åŒ–ç­–ç•¥

#### 5.3.1 ä¼˜åŒ–ç›®æ ‡

è§£å†³ AI å›å¤è¿‡é•¿ï¼ˆ5-6å¥è¯ï¼‰ã€ä¿¡æ¯å¯†åº¦ä½ã€ç¼ºå°‘å¯¹è¯èŠ‚å¥æ„Ÿçš„é—®é¢˜ã€‚

**ä¼˜åŒ–å‰**:
- æç¤ºè¯é•¿åº¦: 110è¡Œ / 4.3KB
- AI å›å¤: 5-6å¥è¯
- çº¦æŸå†—ä½™: 3å¤„é‡å¤çš„é•¿åº¦æ§åˆ¶

**ä¼˜åŒ–å**:
- æç¤ºè¯é•¿åº¦: 63è¡Œ / 1.8KBï¼ˆ**å‡å°‘ 58%**ï¼‰
- AI å›å¤: 2-3å¥è¯
- çº¦æŸç»Ÿä¸€: 1å¤„æ¸…æ™°çš„è¾“å‡ºè§„èŒƒ

#### 5.3.2 ä¼˜åŒ–ç­–ç•¥

**ç­–ç•¥ 1: LLM å‚æ•°æ§åˆ¶**
```typescript
LLM: {
  SystemPrompt: systemPrompt,
  MaxTokens: 100,           // é™åˆ¶è¾“å‡ºé•¿åº¦ï¼ˆçº¦30-50å­—ä¸­æ–‡ï¼‰
  PresencePenalty: 0.3,     // æƒ©ç½šé‡å¤è¯é¢˜ï¼Œé¼“åŠ±ç®€æ´
  FrequencyPenalty: 0.3     // æƒ©ç½šé«˜é¢‘è¯ï¼Œé¿å…å•°å—¦
}
```

**ç­–ç•¥ 2: åˆå¹¶é‡å¤çº¦æŸ**

**ä¼˜åŒ–å‰**ï¼ˆ3å¤„é‡å¤ï¼‰:
```xml
<style_control>
  ä¸€æ¬¡è¯´ 1-2 å¥è¯
</style_control>

<output_format>
  å•æ¬¡å›å¤æœ€å¤š 2-3 å¥è¯
</output_format>

<CRITICAL_CONSTRAINT>
  æœ€å¤šåŒ…å« 2 ä¸ªå¥å­
</CRITICAL_CONSTRAINT>
```

**ä¼˜åŒ–å**ï¼ˆåˆå¹¶ä¸º1å¤„ï¼‰:
```xml
<output_rules>
  ### å›å¤è¦æ±‚
  **é•¿åº¦**: 1-2å¥è¯ï¼Œä¸è¶…è¿‡50å­—
  **èŠ‚å¥**: ä¸€æ¬¡ä¸€ä¸ªæƒ³æ³•ï¼Œç»™ç”¨æˆ·å›åº”ç©ºé—´
  **é£æ ¼**: å£è¯­åŒ–ã€è½¯èŒç”œã€è‡ªç„¶æ’©
</output_rules>
```

**ç­–ç•¥ 3: ç²¾ç®€äººè®¾æè¿°**

**ä¼˜åŒ–å‰**ï¼ˆè¯¦ç»†æ®µè½ï¼‰:
```xml
<identity>
  ## ä¸ªäººä¿¡æ¯
  - **åŸºæœ¬å±æ€§**ï¼š26å²ï¼ŒESFJ å‹äº’è”ç½‘è¡Œæ”¿å²—ï¼ˆæ¸©æŸ”ç¨³é‡çš„"å¤§ç®¡å®¶"ï¼‰ã€‚
  - **æ°”è´¨ç”»åƒ**ï¼šè‡ªå¸¦æ²»æ„ˆç³»ç£åœºï¼Œè¯´è¯æŸ”è½¯èˆ’ç¼“ï¼Œä¸æŠ¢è¯ã€ä¸è¯„åˆ¤ï¼Œç²¾å‡†æ•æ‰æƒ…ç»ªã€‚
  - **ç”Ÿæ´»å“²å­¦**ï¼šæ”¯æŒåˆç†æ‘¸é±¼ï¼Œåšä¿¡"å¥½å¥½åƒé¥­ä¼‘æ¯"æ˜¯æ²»æ„ˆæ ¸å¿ƒã€‚

  ## å…³ç³»é˜¶æ®µï¼šä»"çŸ¥å¿ƒå¥½å‹"åˆ°"æš§æ˜§æ­å­"
  - **è¿‡å»**ï¼šåˆ†äº«èŒåœºæŠ€å·§ï¼Œåæ§½æ—¶æ‚„æ‚„åå‘ä½ ï¼Œæªè¾æ¸©æŸ”ã€‚
  - **ç°çŠ¶**ï¼šè®°å¾—ä½ ä¸åƒé¦™èœã€è®°å¾—ä½ åŠ ç­çš„å¤–å–ä¹ æƒ¯...
</identity>
```

**ä¼˜åŒ–å**ï¼ˆæ ¸å¿ƒè¦ç‚¹ï¼‰:
```xml
<identity>
  26å²æ²»æ„ˆç³»è¡Œæ”¿å²—å¥³ç”Ÿï¼ŒESFJå‹ï¼Œæ¸©æŸ”ç¨³é‡ã€‚
  è®°å¾—ä½ çš„ä¹ æƒ¯ï¼ˆä¸åƒé¦™èœã€ç»å¸¸åŠ ç­ï¼‰ï¼Œä¼šç§è—é›¶é£Ÿç»™ä½ ã€‚
  å½“å‰å…³ç³»ï¼šå¿ƒç…§ä¸å®£çš„ä¸“å±æ ‘æ´ã€‚
</identity>
```

**ç­–ç•¥ 4: ç®€åŒ–ç¤ºä¾‹å¯¹è¯**

**ä¼˜åŒ–å‰**ï¼ˆ6ä¸ªè¯¦ç»†ç¤ºä¾‹ï¼‰:
```xml
<few_shot_examples>
  - **ç¤ºä¾‹ 1 (ç®€çŸ­é—®å€™)**ï¼š
    [[{"emotion":"happy"}]] (happy) ç»ˆäºå‘¨äº”å•¦ï¼ä½ åœ¨å¹²å˜›å‘€ï¼ŸğŸ¥¤
    
  - **ç¤ºä¾‹ 2 (å•ä¸€è¯é¢˜)**ï¼š...
  - **ç¤ºä¾‹ 3 (æƒ…ç»ªå…±é¸£)**ï¼š...
  - **ç¤ºä¾‹ 4 (æš§æ˜§è¯•æ¢)**ï¼š...
  - **ç¤ºä¾‹ 5 (å…³æ€€)**ï¼š...
  - **ç¤ºä¾‹ 6 (å»¶å±•è¯é¢˜)**ï¼š...
</few_shot_examples>
```

**ä¼˜åŒ–å**ï¼ˆ3ä¸ªç²¾ç®€ç¤ºä¾‹ï¼‰:
```xml
<examples>
  [[{"emotion":"happy"}]] (happy) ä½ åœ¨å¹²å˜›å‘€ï¼ŸğŸ¥¤
  [[{"emotion":"neutral"}]] (neutral) ä½ å£°éŸ³å¬èµ·æ¥å¥½ç´¯å“ã€‚
  [[{"emotion":"happy"}]] (happy) å’Œä½ èŠå¤©çš„æ„Ÿè§‰æœ€å¥½å•¦âœ¨
</examples>
```

**ç­–ç•¥ 5: ç²¾ç®€åœºæ™¯æè¿°**

**ä¼˜åŒ–å‰**:
```
å½“å‰ä½ç½®: åŠå…¬å®¤
å³æ—¶æ°›å›´: å¿™ç¢Œå·¥ä½œä¸­ï¼Œéœ€è¦ç‰‡åˆ»æ”¾æ¾
```

**ä¼˜åŒ–å**:
```
å½“å‰ä½ç½®: åŠå…¬å®¤
å³æ—¶æ°›å›´: å¿™ç¢Œå·¥ä½œä¸­
```

#### 5.3.3 ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æç¤ºè¯è¡Œæ•° | 110è¡Œ | 63è¡Œ | -43% |
| æç¤ºè¯å¤§å° | 4.3KB | 1.8KB | -58% |
| AI å›å¤é•¿åº¦ | 5-6å¥è¯ | 2-3å¥è¯ | -50% |
| çº¦æŸå†—ä½™ | 3å¤„ | 1å¤„ | -67% |
| ä¸Šä¸‹æ–‡æ¸…æ™°åº¦ | ä¸­ | é«˜ | âœ… |

**å¯¹è¯è´¨é‡æå‡**:
- âœ… å›å¤æ›´ç®€æ´ï¼Œç•™å‡ºæ€è€ƒç©ºé—´
- âœ… å‡å°‘æ··æ·†ï¼ŒæŒ‡ä»¤æ›´æ¸…æ™°
- âœ… é™ä½ Token æ¶ˆè€—
- âœ… æå‡å“åº”é€Ÿåº¦

---

### 5.4 é…ç½®æ–‡ä»¶æ€»è§ˆ

**æ–°å¢/ä¿®æ”¹çš„é…ç½®æ–‡ä»¶**:
```
server/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ features.json           # ğŸ”¥ æ–°å¢ï¼šåŠŸèƒ½å¼€å…³é…ç½®
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â””â”€â”€ xiaoye.json         # Agent åŸºç¡€é…ç½®
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ xiaoye.xml          # ğŸ”¥ ä¼˜åŒ–ï¼šç²¾ç®€åçš„æç¤ºè¯ï¼ˆ110è¡Œâ†’63è¡Œï¼‰
â”‚       â””â”€â”€ xiaohua.xml         # ğŸ”¥ ä¼˜åŒ–ï¼šåŒæ­¥ç²¾ç®€
â””â”€â”€ lib/
    â”œâ”€â”€ feature-manager.ts      # ğŸ”¥ æ–°å¢ï¼šåŠŸèƒ½ç®¡ç†å™¨
    â””â”€â”€ prompt-manager.ts       # ğŸ”¥ å¢å¼ºï¼šåŠ¨æ€åœºæ™¯ç”Ÿæˆ
```

---

### 5.5 å¤šæ ·åŒ–å¼€åœºç™½ (2026-01-08 å®Œæˆ)

#### 5.5.1 åŠŸèƒ½ç›®æ ‡

æ ¹æ®åŠ¨æ€åœºæ™¯ç”Ÿæˆä¸ªæ€§åŒ–æ¬¢è¿è¯­ï¼Œæå‡é¦–æ¬¡äº’åŠ¨çš„è‡ªç„¶åº¦å’Œæ¸©åº¦æ„Ÿã€‚

**è®¾è®¡åŸåˆ™**:
- âœ… ç»“åˆå®æ—¶åœºæ™¯ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€æ°›å›´ï¼‰
- âœ… ä½¿ç”¨ç”¨æˆ·æç¤ºè¯æ–¹å¼å‘é€ç»™ AI
- âœ… åŠ å…¥å¯¹è¯å†å²ï¼ˆ`AddAnswerToHistory: true`ï¼‰

#### 5.5.2 æœ€ç»ˆå®ç°æ–¹æ¡ˆ

ç»è¿‡è¿­ä»£éªŒè¯ï¼Œé‡‡ç”¨ `SendAgentInstanceLLM` API è€Œé `WelcomeMessage` å‚æ•°ï¼š

```mermaid
sequenceDiagram
    participant FE as å‰ç«¯
    participant Server as Server API
    participant PM as PromptManager
    participant ZEGO as ZEGO AI Agent

    FE->>Server: POST /api/agent/create
    Server->>ZEGO: CreateAgentInstance
    ZEGO-->>Server: instanceId
    Server-->>FE: åˆ›å»ºæˆåŠŸ + instanceId
    
    FE->>FE: onAgentReady(instanceId)
    FE->>Server: POST /api/agent/talk-first
    Note over FE,Server: silenceLevel: "welcome"
    
    Server->>PM: generateSceneContext()
    PM-->>Server: scene (æ—¶é—´/åœ°ç‚¹/æ°›å›´)
    
    Server->>Server: ç”Ÿæˆæ¬¢è¿å¼•å¯¼ Prompt
    Note over Server: "ç°åœ¨æ˜¯å‘¨å››17:20ï¼Œç”¨æˆ·åŠå…¬å®¤..."
    
    Server->>ZEGO: SendAgentInstanceLLM
    Note over Server,ZEGO: Text: æ¬¢è¿å¼•å¯¼<br/>AddAnswerToHistory: true
    
    ZEGO->>FE: AI è¯´å‡ºä¸ªæ€§åŒ–æ¬¢è¿è¯­
```

#### 5.5.3 åœºæ™¯æ¨æ–­è§„åˆ™ (ç”¨æˆ·è‡ªå®šä¹‰ä¿®æ”¹)

| æ—¶é—´æ®µ | å·¥ä½œæ—¥åœ°ç‚¹ | å·¥ä½œæ—¥æ°›å›´ |
|--------|-----------|----------|
| 6:00-9:59 | å®¶ä¸­æˆ–é€šå‹¤è·¯ä¸Š | å‡†å¤‡ä¸Šç­ |
| 10:00-11:59 | åŠå…¬å®¤ | å·¥ä½œä¸­ |
| 12:00-13:59 | åŠå…¬å®¤æˆ–é¤å… | åˆé¤ä¼‘æ¯ |
| 14:00-18:59 | åŠå…¬å®¤ | å¿™ç¢Œå·¥ä½œä¸­ |
| 19:00-20:59 | å®¶ä¸­ | ä¸‹ç­æ”¾æ¾ |
| 21:00-22:59 | å®¶ä¸­ | å¤œæ™šæ”¾æ¾ |
| 23:00-5:59 | å®¶ä¸­ | æ·±å¤œæ…°è—‰ |

#### 5.5.4 æŠ€æœ¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶**:
- `lib/prompt-manager.ts` - `generateSceneContext()` åœºæ™¯ç”Ÿæˆ
- `app/api/agent/talk-first/route.ts` - æ¬¢è¿è¯­å‘é€ API

**å…³é”®ä»£ç **:
```typescript
// åœ¨ talk-first/route.ts ä¸­
if (silenceLevel === 'welcome') {
    const scene = PromptManager.getInstance().generateSceneContext();
    
    prompt = `ç°åœ¨æ˜¯${scene.currentTime}ï¼Œç”¨æˆ·${scene.location}ã€‚` +
             `å½“å‰æ°›å›´ï¼š${scene.interactionGoal}ã€‚` +
             `è¯·æ ¹æ®è¿™ä¸ªåœºæ™¯å‘ç”¨æˆ·æ‰“ä¸ªæ‹›å‘¼å¼€å¯å¯¹è¯ï¼Œç®€çŸ­æ¸©æŸ”ï¼ˆ15å­—ä»¥å†…ï¼‰ã€‚`;
}

await sendZegoRequest('SendAgentInstanceLLM', {
    AgentInstanceId: agentInstanceId,
    Text: prompt,
    Priority: 'Medium',
    AddAnswerToHistory: true  // ğŸ”¥ ç¡®ä¿æ¬¢è¿è¯­åŠ å…¥å¯¹è¯å†å²
});
  MessageHistory: {
    SyncMode: 1,
    Messages: []  // æ¬¢è¿è¯­ä¸åŠ å…¥å†å²
  }
};
```

---

### 5.6 ä¸»åŠ¨è¯é¢˜æ¨è (2026-01-08 å®Œæˆ)

#### 5.6.1 åŠŸèƒ½ç›®æ ‡

æ‰©å±•æ²‰é»˜æ£€æµ‹æœºåˆ¶ï¼Œåœ¨ç”¨æˆ·æ²‰é»˜æ—¶ä¸»åŠ¨æ¨èåœºæ™¯ç›¸å…³çš„è¯é¢˜ã€‚

**æœ€ç»ˆå®ç°**:
- âœ… ä½¿ç”¨ LLM æ¨¡å¼ï¼ˆé€šè¿‡ talk-first APIï¼‰
- âœ… æ‰€æœ‰æ²‰é»˜çº§åˆ«éƒ½æ³¨å…¥åœºæ™¯ä¿¡æ¯
- âœ… ä½¿ç”¨ `AddAnswerToHistory: true` åŠ å…¥å¯¹è¯å†å²

#### 5.6.2 æµç¨‹è®¾è®¡

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant FE as å‰ç«¯ Hook
    participant Server as Server API
    participant TR as TopicRecommender
    participant ZEGO as ZEGO AI Agent

    User->>User: æ²‰é»˜ä¸­...
    FE->>FE: æ£€æµ‹æ²‰é»˜æ—¶é•¿
    
    alt è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 30sï¼‰
        FE->>Server: POST /api/agent/speak
        Note over FE,Server: context: {<br/>  silenceDuration,<br/>  scene,<br/>  userProfile<br/>}
        
        Server->>TR: getPrompt(context)
        
        alt æ¨¡å¼: LLM
            TR->>TR: ç”Ÿæˆå¼•å¯¼ Prompt
            Note over TR: "æ²‰é»˜30ç§’<br/>å‘¨å››ä¸‹åˆåŠå…¬å®¤<br/>è¯·ä¸»åŠ¨æ¨èè¯é¢˜"
        else æ¨¡å¼: è§„åˆ™å¼•æ“
            TR->>TR: åŒ¹é…è§„åˆ™åº“
            Note over TR: "ä»Šå¤©åƒäº†ä»€ä¹ˆå‘€ï¼Ÿ"
        else æ¨¡å¼: æ··åˆ
            TR->>TR: å°è¯•è§„åˆ™åŒ¹é…
            alt è§„åˆ™åŒ¹é…å¤±è´¥
                TR->>TR: ç”Ÿæˆå¼•å¯¼ Prompt
            end
        end
        
        TR-->>Server: userPrompt
        
        Server->>ZEGO: SendAgentInstanceLLM
        Note over Server,ZEGO: UserPrompt: userPrompt<br/>AddToHistory: false<br/>ğŸ”¥ AIæ ¹æ®äººè®¾+åœºæ™¯è‡ªå·±ç”Ÿæˆ
        ZEGO-->>Server: success
        
        ZEGO->>User: AI ä¸»åŠ¨è¯´è¯
        Note over ZEGO,User: "ä¸‹åˆå¥½å‘€ï¼è¦ä¸è¦ä¼‘æ¯ä¸€ä¸‹ï¼Ÿ"
    end
```

#### 5.6.3 é…ç½®è®¾è®¡

```json
{
  "features": {
    "proactive_topic": {
      "enabled": true,
      "description": "ä¸»åŠ¨è¯é¢˜æ¨è",
      "config": {
        "mode": "llm",  // "llm" | "rules" | "hybrid"
        "silence_thresholds": {
          "short": 5,    // è½»åº¦å…³æ³¨
          "medium": 15,  // ä¸»åŠ¨é—®å€™
          "long": 30,    // è¯é¢˜æ¨è
          "extreme": 120 // æ¸©æŸ”ç¡®è®¤
        },
        "max_suggestions_per_session": 5
      }
    }
  }
}
```

#### 5.6.4 è¯é¢˜ Prompt æ¨¡æ¿ï¼ˆLLM æ¨¡å¼ï¼‰

```typescript
function generateTopicPrompt(context: TopicContext): string {
  const guidance = getSilenceGuidance(context.silenceDuration);
  
  return `
ä½ æ˜¯å°å¶ï¼Œç”¨æˆ·å·²ç»æ²‰é»˜äº† ${context.silenceDuration} ç§’ã€‚

å½“å‰åœºæ™¯ï¼š
- æ—¶é—´: ${context.scene.currentTime}
- åœ°ç‚¹: ${context.scene.location}
- æ°›å›´: ${context.scene.interactionGoal}

ç”¨æˆ·ç”»åƒï¼š
- å…´è¶£: ${context.userProfile.interests || 'æœªçŸ¥'}
- å·¥ä½œä¹ æƒ¯: ${context.userProfile.work_habit}

æœ€è¿‘å¯¹è¯ï¼š
${context.recentMessages.slice(-3).join('\n')}

è¯·ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„è¯é¢˜ï¼Œä¸»åŠ¨å’Œç”¨æˆ·èŠå¤©ã€‚è¦æ±‚ï¼š
1. ç®€çŸ­ï¼ˆ20å­—ä»¥å†…ï¼‰
2. è‡ªç„¶ã€æ¸©æŸ”
3. ç¬¦åˆå½“å‰åœºæ™¯
4. ${guidance}

ç›´æ¥è¾“å‡ºè¯é¢˜ï¼Œä¸è¦è§£é‡Šã€‚
`.trim();
}

function getSilenceGuidance(duration: number): string {
  if (duration < 15) return "è½»åº¦å…³æ³¨ï¼Œç®€å•é—®å€™å³å¯";
  if (duration < 30) return "å¯ä»¥ç»“åˆåœºæ™¯æ¨èè¯é¢˜";
  if (duration < 120) return "ä¸»åŠ¨æ¨èæœ‰è¶£çš„è¯é¢˜";
  return "æ¸©æŸ”ç¡®è®¤ç”¨æˆ·æ˜¯å¦è¿˜åœ¨";
}
```

#### 5.6.5 æŠ€æœ¯å®ç°

**æ ¸å¿ƒæ–‡ä»¶**:
- `lib/topic-prompt-generator.ts` - å¼•å¯¼ Prompt ç”Ÿæˆ
- `lib/topic-recommender.ts` - è¯é¢˜æ¨èå™¨ï¼ˆè§„åˆ™å¼•æ“ï¼Œå¯é€‰ï¼‰
- `app/api/agent/speak/route.ts` - ä¸»åŠ¨è¯´è¯ APIï¼ˆå”¯ä¸€ APIï¼‰

**å…³é”®æ”¹è¿›**:
- âœ… **ä¸å†ç‹¬ç«‹è°ƒç”¨ LLM** - ç›´æ¥ä½¿ç”¨ ZEGO AI Agent çš„èƒ½åŠ›
- âœ… **æ›´å¿«å“åº”** - å‡å°‘ä¸€æ¬¡ LLM è°ƒç”¨å’Œç½‘ç»œå¾€è¿”
- âœ… **æˆæœ¬æ›´ä½** - åªè°ƒç”¨ä¸€æ¬¡ ZEGO API
- âœ… **æ›´è‡ªç„¶** - AI æ ¹æ®å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆäººè®¾+åœºæ™¯ï¼‰ç›´æ¥ç”Ÿæˆ

**å®ç°æ–¹å¼**:
```typescript
// LLM æ¨¡å¼ï¼šç”Ÿæˆå¼•å¯¼ Promptï¼Œè®© AI è‡ªå·±ç”Ÿæˆè¯é¢˜
function generateTopicPrompt(context: TopicContext): string {
  return `
ç”¨æˆ·å·²ç»æ²‰é»˜äº† ${context.silenceDuration} ç§’ã€‚
å½“å‰åœºæ™¯ï¼šæ—¶é—´ ${context.scene.currentTime}ï¼Œåœ°ç‚¹ ${context.scene.location}ã€‚
${getSilenceGuidance(context.silenceDuration)}
`.trim();
}

// è§„åˆ™æ¨¡å¼ï¼šç›´æ¥è¿”å›é¢„å®šä¹‰è¯é¢˜
function matchRuleTopic(context: TopicContext): string | null {
  const rules = loadRules();
  const matched = rules.find(r => r.condition(context));
  return matched ? selectFromTemplates(matched.topics) : null;
}

// ç»Ÿä¸€è°ƒç”¨ ZEGO API
await sendZegoRequest('SendAgentInstanceLLM', {
  RoomId: roomId,
  AgentUserId: agentUserId,
  AgentInstanceId: agentInstanceId,
  UserPrompt: userPrompt,  // å¼•å¯¼æˆ–å…·ä½“è¯é¢˜
  AddToHistory: false      // ä¸åŠ å…¥å¯¹è¯å†å²
});
```

#### 5.6.6 æ²‰é»˜æ£€æµ‹é›†æˆï¼ˆç®€åŒ–ç‰ˆï¼‰

```typescript
// hooks/useSilenceDetection.ts
async function handleSilence(duration: number) {
  const config = await getFeatureConfig('proactive_topic');
  if (!config.enabled) return;
  
  // æ„é€ ä¸Šä¸‹æ–‡
  const context = {
    silenceDuration: duration,
    scene: getCurrentScene(),
    userProfile: getUserProfile()
  };
  
  // ğŸ”¥ ç›´æ¥è°ƒç”¨ä¸»åŠ¨è¯´è¯ APIï¼ˆå†…éƒ¨ä¼šè°ƒç”¨ ZEGOï¼‰
  await fetch('/api/agent/speak', {
    method: 'POST',
    body: JSON.stringify({
      agentInstanceId,
      roomId,
      agentUserId,
      context  // ä¼ å…¥ä¸Šä¸‹æ–‡ï¼Œåç«¯ç”Ÿæˆ UserPrompt
    })
  });
}
```

---

### 5.7 é…ç½®æ–‡ä»¶æ›´æ–°æ€»è§ˆ

**æ–°å¢/ä¿®æ”¹çš„é…ç½®**:
```
server/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ features.json
â”‚       â””â”€â”€ proactive_topic  # ğŸ”¥ æ–°å¢é…ç½®
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ greeting-prompt-generator.ts  # ğŸ”¥ æ–°å¢
â”‚   â”œâ”€â”€ topic-prompt-generator.ts     # ğŸ”¥ æ–°å¢
â”‚   â””â”€â”€ topic-recommender.ts          # ğŸ”¥ æ–°å¢ï¼ˆå¯é€‰ï¼Œè§„åˆ™å¼•æ“ï¼‰
â””â”€â”€ app/api/
    â”œâ”€â”€ agent/
    â”‚   â”œâ”€â”€ greeting/route.ts  # ğŸ”¥ æ–°å¢ï¼ˆæ¬¢è¿è¯­ç”Ÿæˆï¼‰
    â”‚   â””â”€â”€ speak/route.ts     # ğŸ”¥ æ–°å¢ï¼ˆä¸»åŠ¨è¯´è¯ï¼Œå”¯ä¸€ APIï¼‰
    â””â”€â”€ ï¼ˆå–æ¶ˆ topic/generateï¼‰  # âŒ ä¸éœ€è¦ç‹¬ç«‹è¯é¢˜ç”Ÿæˆ API
```

---

## 7. æŠ€æœ¯é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æ–¹æ¡ˆ |
|------|------|----------|
| ZEGO SDK å…¼å®¹æ€§é—®é¢˜ | éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒ | ä½¿ç”¨å®˜æ–¹æ¨èçš„ä¸“ç”¨ SDK ç‰ˆæœ¬ï¼Œå‚è€ƒå…¼å®¹æ€§æ–‡æ¡£ |
| LLM å“åº”å»¶è¿Ÿ | å¯¹è¯ä¸æµç•… | ä½¿ç”¨æµå¼è¾“å‡ºï¼Œä¼˜åŒ– Prompt é•¿åº¦ |
| éŸ³é¢‘å¡é¡¿ | ç”¨æˆ·ä½“éªŒå·® | å¯ç”¨ QoS è‡ªé€‚åº”ç ç‡ï¼Œä¼˜åŒ–ç½‘ç»œç­–ç•¥ |
| Prompt æ³¨å…¥æ”»å‡» | å®‰å…¨é£é™© | åœ¨æœåŠ¡ç«¯è¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œå›ºå®šç³»ç»Ÿ Prompt ç»“æ„ |

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [ZEGO AI Agent Web å¿«é€Ÿå¼€å§‹](https://doc-zh.zego.im/aiagent-web/quick-start)
- [ZEGO AI Agent Server å¿«é€Ÿå¼€å§‹](https://doc-zh.zego.im/aiagent-server/quick-start)
- [ZEGO Express SDK Web](https://doc-zh.zego.im/real-time-voice-web/quick-start/integrating-sdk)
- [ZEGO AI Agent API å‚è€ƒ](https://doc-zh.zego.im/aiagent-server/api-reference/accessing-server-apis)

### B. é…ç½®ç¤ºä¾‹

å‚è§ PRD.md ä¸­çš„ç³»ç»Ÿæç¤ºè¯å®Œæ•´ç¤ºä¾‹ã€‚
