# Agent 设计规范

> **目的**：约束所有 Agent 的 System Prompt 设计，确保简洁、结构化、可维护

---

## 一、Prompt 设计原则

### 1.1 简洁性原则

| ❌ 禁止 | ✅ 应该 |
|--------|--------|
| 大段描述性文字 | 使用结构化标签 + 简洁要点 |
| 重复说明同一规则 | 一处定义，其他引用 |
| 示例过多（>5个） | 2-3 个典型示例足矣 |
| 模糊的形容词 | 具体、可执行的指令 |

### 1.2 结构化原则

```xml
<!-- 标准结构 -->
<section_name>
  ## 模块标题
  - 要点 1
  - 要点 2
</section_name>
```

- 每个模块有明确边界（XML 标签）
- 模块内使用 Markdown 格式
- 动态内容与静态内容分离

### 1.3 模块化原则

| 模块类型 | 更新频率 | 示例 |
|----------|----------|------|
| **固定模块** | 几乎不变 | 人设核心、能力边界 |
| **动态模块** | 每次会话更新 | 当前时间、场景状态 |
| **会话模块** | 特定场景注入 | 游戏状态、任务进度 |

---

## 二、Prompt 结构模板

### 2.1 人设 LLM 标准结构

```xml
<!-- 固定：人设核心 (300-500 tokens) -->
<character>
  ## 身份
  - 姓名/年龄/性格
  ## 语言风格
  - 口语化/颜文字偏好
</character>

<!-- 固定：能力边界 (100-200 tokens) -->
<capabilities>
  ## 我能做
  - 陪聊/游戏/新闻整理
  ## 我不做
  - 专业医疗/法律建议
</capabilities>

<!-- 固定：引导策略 (100-150 tokens) -->
<guide_rules>
  - 沉默 30s → 推荐话题
  - 用户说"无聊" → 推荐游戏
</guide_rules>

<!-- 动态：当前场景 (50-100 tokens) -->
<scene>
  时间: 2026-01-12 12:00
  场景: 闲聊 | 游戏(海龟汤) | 任务处理
</scene>

<!-- 会话：可选模块 -->
<game_state>只在游戏中注入</game_state>
<task_state>只在任务处理中注入</task_state>
```

### 2.2 Token 预算

| 模块 | 预算 | 说明 |
|------|------|------|
| 人设核心 | ≤500 | 不可压缩的核心设定 |
| 能力边界 | ≤200 | 列表形式，简洁 |
| 引导策略 | ≤150 | 规则化，非描述性 |
| 动态场景 | ≤100 | 仅关键上下文 |
| 会话模块 | ≤200 | 按需注入 |
| **总计** | **≤1150** | 理想控制在 1000 以内 |

---

## 三、交互模式判断规则

### 3.1 基于预估时间的判断

```
用户请求
    │
    ▼
┌─────────────────────────────────────────┐
│ 调度 Agent 评估：任务预估完成时间        │
│                                         │
│ • 信息是否充足？                         │
│ • 预估执行时间？                         │
└─────────────────────────────────────────┘
    │
    ├── 信息充足 + 时间 < 2s ──▶ 直接执行（试错成本低）
    │
    ├── 信息不足 OR 时间 > 5s ──▶ 先确认细节
    │
    └── 时间 2-5s ──▶ 看信息完整度决定
```

### 3.2 示例

| 用户输入 | 信息完整度 | 预估时间 | 处理方式 |
|----------|-----------|----------|----------|
| "今天天气咋样" | ⚠️ 缺少地点 | ~1s | 直接用默认地点，快速返回 |
| "帮我整理新闻" | ❌ 缺少类型 | ~5s | 先问类型 |
| "北京今天天气" | ✅ 完整 | ~1s | 直接执行 |
| "写一篇科技新闻总结" | ✅ 完整 | ~10s | 先确认格式/篇幅 |

---

## 四、能力引导实现

### 4.1 实现方式

| 方式 | 场景 | 说明 |
|------|------|------|
| **欢迎语注入** | 首次通话 | 通过 `UserPrompt` 注入场景信息 + 引导提示 |
| **沉默检测** | 用户沉默 30s | 现有机制，触发主动话题推荐 |
| **上下文感知** | 用户说"无聊" | Prompt 内置规则，触发游戏推荐 |

### 4.2 与动态打招呼的结合

```
首次通话欢迎语 = 动态时间打招呼 + 能力引导

示例（周五晚上 21:00）：
"周五晚上好呀～终于可以放松啦！
 对了，要是无聊的话，我们可以玩玩海龟汤，或者我帮你看看今天有什么新闻热点？"
```

---

## 五、新闻整理策略

### 5.1 渐进式输出

```
第一轮：简要摘要（3 条标题）
"今天科技圈有几个热点：
 1. xxx
 2. xxx
 3. xxx
 你想详细了解哪一条？"

第二轮：详细展开（用户选择后）
"关于 xxx，事情是这样的..."
```

### 5.2 用户偏好处理

| 偏好来源 | 处理方式 |
|----------|----------|
| 本次明确提出 | 优先级最高，直接按需求处理 |
| 历史记忆中的偏好 | 默认应用，但可被当前覆盖 |
| 无偏好 | 使用默认策略（渐进式） |

---

## 六、检查清单

设计新 Prompt 时，必须检查：

- [ ] 总 Token 数 < 1000？
- [ ] 每个模块有 XML 标签边界？
- [ ] 动态内容与固定内容分离？
- [ ] 示例数量 ≤ 3？
- [ ] 无重复说明？
- [ ] 规则可执行（非模糊形容）？
