# v2.2.3 - 多任务 PRD

> **版本**：v2.2.3  
> **日期**：2026-01-20  
> **状态**：待开发  
> **前置**：[v2.2.2 高复杂度](./2.2.2-高复杂度.md)  
> **核心架构**：[任务处理模块-核心架构](./2.2-任务处理模块-核心架构.md)

---

## 一、版本目标

> 支持多任务并行、优先级管理、任务生命周期控制

**交付功能**：
- ✅ 多任务解析（一次触发多个）
- ✅ 优先级管理
- ✅ 任务去重
- ✅ 暂停/恢复
- ✅ 任务列表面板

**预估工时**：3-4 天

---

## 二、用户场景

### 2.1 一次触发多任务

```
用户 → "帮我查热点新闻，再整理下邮件，邮件比较重要优先"
       ↓
[解析出2个任务，识别优先级]
       ↓
AI   → "收到2个任务：
       1. 邮件整理（优先）
       2. 热点新闻
       我来处理～"
       ↓
[邮件优先执行，新闻同时后台处理]
```

### 2.2 任务去重

```
用户 → "帮我整理邮件"
[任务执行中]
用户 → "帮我整理邮件"
       ↓
AI   → "已经在整理了，稍等一下哦～"
```

```
[邮件刚完成]
用户 → "帮我整理邮件"
       ↓
AI   → "刚才已经整理过了，要看刚才的结果还是重新整理？"
```

### 2.3 暂停/恢复

```
用户 → "旅游规划先暂停"
       ↓
AI   → "好的，旅游规划先放一边，需要时叫我～"
[状态：paused]

用户 → "继续刚才的旅游规划"
       ↓
AI   → "好的，从断点继续～"
[状态：running]
```

### 2.4 任务列表查询

```
用户 → "现在有哪些任务在进行"
       ↓
AI   → "目前有2个任务：
       1. 邮件整理，进度40%
       2. 旅游规划，已暂停"
```

---

## 三、技术设计

### 3.1 多任务解析

```typescript
interface ParsedTasks {
  tasks: Array<{
    taskId: string;
    params: Record<string, any>;
    priority: 'high' | 'medium' | 'low';
  }>;
}
```

优先级识别关键词：
- 高：重要、优先、先、急
- 低：顺便、有空、之后

### 3.2 任务去重配置

```yaml
dedup:
  enabled: true
  cache_ttl: 300  # 结果缓存5分钟
  same_task_running: prompt  # reject | prompt | allow
  same_task_completed: ask   # reuse | ask | redo
```

### 3.3 任务状态持久化

```
data/tasks/
├── {roomId}_active.json    # 活跃任务列表
└── {roomId}_history.json   # 历史任务（去重用）
```

---

## 四、前端需求

### 4.1 任务列表面板

```
┌───────────────────────────┐
│  📋 进行中 (3)             │
├───────────────────────────┤
│  🔴 邮件整理  ████░ 40%  │
│  🟡 热点新闻  执行中       │
│  ⏸️ 旅游规划  暂停        │
├───────────────────────────┤
│  [管理任务]               │
└───────────────────────────┘
```

- 位置：通话页面可折叠面板
- 操作：查看、暂停、恢复、取消

---

## 五、后端需求

### 5.1 新增模块

| 模块 | 说明 |
|------|------|
| `MultiTaskParser` | 多任务解析 |
| `TaskQueue` | 任务队列管理 |
| `PriorityScheduler` | 优先级调度 |
| `DedupManager` | 去重管理 |

---

## 六、验收标准

| 场景 | 验收标准 |
|------|----------|
| 多任务解析 | 正确识别多个任务 |
| 优先级 | 按指定顺序执行 |
| 去重（执行中） | 提示已在处理 |
| 去重（已完成） | 询问复用/重做 |
| 暂停/恢复 | 从断点继续 |
| 任务列表 | 正确显示状态 |

---

## 七、后续版本

完成后进入 [v2.2.5 - 插件化](./2.2.5-插件化.md)
